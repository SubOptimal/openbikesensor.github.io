<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.80.0"><link rel=canonical type=text/html href=/en/docs/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>OpenBikeSensor Documentation | OpenBikeSensor</title><meta property="og:title" content="OpenBikeSensor Documentation"><meta property="og:description" content="Passing distance measurement for cyclists. Open source, open data, open science."><meta property="og:type" content="website"><meta property="og:url" content="/en/docs/"><meta property="og:site_name" content="OpenBikeSensor"><meta itemprop=name content="OpenBikeSensor Documentation"><meta itemprop=description content="Passing distance measurement for cyclists. Open source, open data, open science."><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenBikeSensor Documentation"><meta name=twitter:description content="Passing distance measurement for cyclists. Open source, open data, open science."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-00000000-0','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.ddc681e582e462e75556f6d1a3140f4948a17e72c2543ee445567d3048eabf6e.css as=style><link href=/scss/main.min.ddc681e582e462e75556f6d1a3140f4948a17e72c2543ee445567d3048eabf6e.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=/js/slider/ideal-image-slider.min.js></script><script src=/js/slider/iis-bullet-nav.js></script><script src=/js/slider/iis-captions.js></script><script src=/js/obs.js></script><link rel=stylesheet href=/css/slider/ideal-image-slider.css><link rel=stylesheet href=/css/slider/themes/default.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/svg+xml sizes=any href=/favicon.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileImage content="/mstile-144x144.png"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/en/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">OpenBikeSensor</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/en/><span class=active>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/en/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/en/community/><span>Community</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/>Deutsch</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/en/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>OpenBikeSensor Documentation</h1><ul><li>1: <a href=#pg-6b53b5e2a125dde3a0f8b31d42b3ffdc>User Guide</a></li><ul><li>1.1: <a href=#pg-0dbbe60e6d8f544d8d2c513623c7dd31>Quick Start Guide</a></li><li>1.2: <a href=#pg-9a42fb70f0d529d972dd5940ebdf5d03>Mounting the sensor to a bike</a></li><li>1.3: <a href=#pg-1823afea81fdf2b7da65bf68d7c36320>Configuration</a></li><ul><li>1.3.1: <a href=#pg-4667f0745384c187c2b9f5fff6c2b47d>Minimal Configuration</a></li><li>1.3.2: <a href=#pg-48d0d234555c8f4feba9ac6a421e956a>Advanced</a></li></ul><li>1.4: <a href=#pg-50e3f3907a7b778b0dfc002be8a67eaf>Recording a track</a></li><li>1.5: <a href=#pg-d7280f9c12c986960144dbd9ce2801c8>Privacy Zones</a></li><li>1.6: <a href=#pg-beffaa5d188b9df46ca63cdc8d623311>Upload tracks</a></li></ul><li>2: <a href=#pg-65ce47be58e50c833d4c5fe575adf07f>Hardware</a></li><ul><li>2.1: <a href=#pg-27ad6fc5bac62f82eeb736977db5a679>Model selection</a></li><li>2.2: <a href=#pg-661fbae2376b157f5023e3285970c015>Getting a PCB</a></li><li>2.3: <a href=#pg-0da161ca0a5800ed37ca21d9c96efab0>Printing a case</a></li><ul></ul><li>2.4: <a href=#pg-65f52b9267476c5abe0ddd1c3c48c44a>Parts Lists for all versions</a></li><ul><li>2.4.1: <a href=#pg-d85fb319316065a6453af18f82f68315>Collective Orders</a></li><ul></ul></ul><li>2.5: <a href=#pg-1e6374192557efdc9d48cc4785eba0e6>Building your OBS v00.02</a></li><ul><li>2.5.1: <a href=#pg-7fe0127b16ab48ddf24fbcf7b13373ad>Build instructions v00.02</a></li></ul><li>2.6: <a href=#pg-735c2cb56859a9fd32fbf51cd2cd3581>Building your OBS v00.03</a></li><ul><li>2.6.1: <a href=#pg-44223aaa14ba03a465870ff5507d31cb>Build instructions v00.03</a></li></ul></ul><li>3: <a href=#pg-dfd48793659645274fbc4a4e0fa01cc1>Software</a></li><ul><li>3.1: <a href=#pg-c5e1fe529f2ff2be7e16d98de9060468>Firmware</a></li><ul><li>3.1.1: <a href=#pg-6e6702eb42236c263c53cf28d2ce5b52>Architecture</a></li><li>3.1.2: <a href=#pg-226236cbe2459b8085bcc02bf22e1187>Setup of Development Environment</a></li><li>3.1.3: <a href=#pg-51331aee17c036ec192377ca955df78c>Coding Guidelines</a></li><li>3.1.4: <a href=#pg-2df86ca66efc82c707a6685b81577602>Upgrading the Firmware from 0.2.x to 0.3.x</a></li></ul></ul><li>4: <a href=#pg-86bf20d39037f4ae49a1ae0ca3c28fa3>Acknowledgments</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-6b53b5e2a125dde3a0f8b31d42b3ffdc>1 - User Guide</h1><p>This section helps you <em>use</em> your OpenBikeSensor (OBS). Think of it like the
manual that came with the device, only we don&rsquo;t need to print it. No matter
whether you built your sensor yourself, or got a pre-built sensor from someone
else, this guide describes how you can help collect important data with your
fancy new device.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0dbbe60e6d8f544d8d2c513623c7dd31>1.1 - Quick Start Guide</h1><blockquote><p>This guide assumes that you have a working OpenBikeSensor. <a href=/en/docs/hardware/ title=Hardware>If you don&rsquo;t, start here!</a></p></blockquote><p>In case you might get a OpenBikeSensor, you should do some first steps.</p><ol><li>Check, if your handlebar fits the OpenBikeSensor&rsquo;s display/button holder.
There are basically two different kinds of handlebars: thinner ones, with a
25,4mm diameter and the other ones, with a 31.8mm diameter. You might create
some kind of adapter, if the device is designed for 31,8mm and you have a
25,4mm handlebar, but the other way around is not possible</li><li>Measure the distance between the outer edge of the device and the end of
your handlebar. Enter these values into the configuration options.</li><li>Set your privacy zones. You could probably get the GPS location with any
digital map app. Enter these values into the configuration options.</li><li>Check the SD card, if it&rsquo;s ok and - in best case - empty.</li><li>Load the device&rsquo;s battery.</li><li>Turn on your device. Wait until the it has found your GPS location. This
might take some time while we&rsquo;re waiting for the sattelites to connect. The
display will exit the status screen as soon as your location is known.
While moving it might take up to 15mins, until the devices knows where you
are &ndash; stand still for a faster process.</li><li>Put your sensor on the bike and go for a ride. Please take care about
traffic around you and don&rsquo;t let the OpenBikeSensor distract you!</li><li>Push the button every time you&rsquo;re passed (no matter if it&rsquo;s a car or truck
or bus or motorbike). To get some idea how often close passes occur, it&rsquo;s
important to confirm every pass, not only the close ones.</li><li>After your ride, switch off the device. Hold the button on the display while
throwing the switch to ensure you don&rsquo;t lose any data.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-9a42fb70f0d529d972dd5940ebdf5d03>1.2 - Mounting the sensor to a bike</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/user-guide/mounting/>Deutsch</a>: Montage des Sensors am Fahrrad</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1823afea81fdf2b7da65bf68d7c36320>1.3 - Configuration</h1></div><div class=td-content><h1 id=pg-4667f0745384c187c2b9f5fff6c2b47d>1.3.1 - Minimal Configuration</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/user-guide/configuration/minimal/>Deutsch</a>: Minimal-Konfiguration</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-48d0d234555c8f4feba9ac6a421e956a>1.3.2 - Advanced</h1><h2 id=how-to-enter-configuration-mode>How to enter configuration mode</h2><p>You can enter the configuration mode by pushing the button while turning on the
device.</p><h3 id=access-point-mode>Access Point Mode</h3><ul><li>On first start of the configuration mode or if you are outside of the Range of your WiFi, the OpenBikeSensor will open a unique WiFi access point</li><li>The access point is named after the MAC adress &ldquo;OpenBikeSensor-xxxxxxxxxxxx&rdquo; with the initial password &ldquo;12345678&rdquo;</li><li>The configuration page can be found on &ldquo;172.20.0.1&rdquo; on the AP</li></ul><h3 id=wifi-mode>WiFi Mode</h3><ul><li>It might be neccessary to de-activate the mobile data on your mobile phone to access this page.</li><li>OBS can also connect to an existing WiFi, if credentials were entered in a previous configuration (see WiFi Settings)</li><li>Connected to an existing WiFi, the IP adress of the configuration page is shown on the device&rsquo;s display.</li></ul><h2 id=structure-of-the-configuration-menus>Structure of the Configuration Menus</h2><h3 id=general>General</h3><h4 id=sensor>Sensor</h4><p>Define the offset between the end of your handle bar and the outer edge of the OpenBikeSensor. These values will automatically get substracted from the current measurement. Additionally you could &ldquo;swap&rdquo; the left and right measurement, in case you flip the device on your bike.</p><h4 id=gps>GPS</h4><p>You could define, in which way your device will acknowledge a valid GPS fix and starts operation. Typically it will start regular operation when it has contact to 4 gps satellites.</p><h4 id=generic-display>Generic Display</h4><ul><li>flip the display, if you need to mount it upside down</li><li>invert the display bright / dark parts, which might help in bright sunlight.</li></ul><h4 id=measurement-display>Measurement Display</h4><p>Here are several options, which values you might want to see on your display.</p><ul><li>&ldquo;simple mode&rdquo; – display only of measurement to the left</li><li>Show left / right measurement</li><li>Show satellite – display of number of gps satellites recognized by the device
(more satellites – more accurate positioning)</li><li>Show velocity – display of actual speed (quite rough because of slow
measurement intervals)</li><li>Show confirmation stats – counts button press and confirmed detection of
surpassing events</li><li>Show nerd details for distance sensors – display of raw data of sensors and
number of measuring events within one second (helpful for troubleshooting)</li></ul><h4 id=privacy-options>Privacy Options</h4><p>To keep some privacy, you could tell your device to stop recording near your
home or any other privacy zone. This could be no recording at all or just no
GPS-tracking any more, but still storing all confirmed passes.</p><p>Define your home location and diameter of the privacy zone in the corresponding menu.</p><h4 id=upload-user-data>Upload User Data</h4><p>Setup for upload-server to collect track data</p><ul><li>Preset for HLRS-project: openbikesensor.hlrs.de</li><li>To upload track data, you need a user account on the website openbikesensor.hlrs.de (or other compatible online-service)</li><li>API Key: Insert the individual API key from your user account at openbikesensor.hlrs.de in the field below the upload sensor</li></ul><h4 id=operation>Operation</h4><ul><li>Enable Bluetooth – (from Firmware version 0.3dev.) check if you want to
connect your Openbiksesensor to a compatible Smartphone App s.a. SimRa</li><li>SimRa Mode – check if you are connecting the Openbikesensor with the SimRa
App</li></ul><h3 id=privacy-zones>Privacy Zones</h3><p>You could set as many privacy zones, as you like, including their own radius.
In the Privacy Options you define how your OpenBikeSensor behaves while inside
a Privacy Zone.</p><h3 id=wifi-settings>WiFi Settings</h3><p>The OpenBikeSensor can connect to an available WiFi if you supply its
credentials. This is convenient when you want to stay connected to your local
WiFi when configuring the sensor. It will tell you the IP adress to connect to
on the display.</p><p>To upload track from the Open Bike Sensor directly a WiFi connection with
internet access is necessary.</p><h3 id=backup--restore>Backup & Restore</h3><p>Here you can back up the configuration of your OpenBikeSensor to your PC or
mobile device. To restore from a saved configuration chose the corresponding
file in the menu dialog. Use this option before firmware updates to ensure you
can restore your settings if they get lost in the process.</p><h3 id=update-firmware>Update Firmware</h3><p>After downloading the latest release (or any other version, in case you need a
special setup), just click on &ldquo;Update&rdquo; in the options. Select the downloaded
file and click update. The device will automatically reboot after a successful
update.</p><p>You can directly upload a precompiled binary; the latest release can always be
found
<a href=https://github.com/openbikesensor/OpenBikeSensorFirmware/releases>here</a>.</p><h3 id=reboot>Reboot</h3><p>This button restarts the device into the regular measurement mode and leaves
the options.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-50e3f3907a7b778b0dfc002be8a67eaf>1.4 - Recording a track</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/user-guide/recording/>Deutsch</a>: Aufzeichnung einer Messfahrt</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d7280f9c12c986960144dbd9ce2801c8>1.5 - Privacy Zones</h1><p>Privacy zones are an important concept in the OpenBikeSensor ecosystem. They
are used in the sensor device itself, but also on the Data Portal, to mask your
location in certain areas.</p><p>This is a crucial privacy feature. Since uploaded data may become published in
the Open Data repository, users may (or actually should) choose to configure
these privacy zones to protect their privacy. A bad actor might otherwise be
able to find out from the data where they live, work, or frequently hang out.</p><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4>The Data Portal does <strong>not yet</strong> support privacy zones. But we&rsquo;re working on
it, and the way it is described here matches what will be possible.</div><h2 id=how-privacy-zones-work>How privacy zones work</h2><p>A privacy zone can be configured in the sensor device itself, changing its
recording activity, and in the Data Portal, which then uses it to filter data
before publishing. Depending on how you use your sensor and what your level of
concern is, you might choose either or both of these options.</p><p>A privacy zone is a circular area, defined by a center point and the radius,
around which data is masked. You should set up multiple of these zones at
relevant locations, so that bad actors cannot identify where your tracks start
and end:</p><ul><li>Your home</li><li>Your workplace</li><li>Your friends' homes</li><li>Anywhere you frequently ride your bike or regularily hang out</li></ul><h2 id=recording-modes>Recording modes</h2><p>There are 4 modes of operation for the OpenBikeSensor:</p><blockquote><p>TODO</p></blockquote><h2 id=which-one-to-choose>Which one to choose</h2><p>The settings inside the OBS are applied <em>as it records the data</em>. So anything
not recorded due to a privacy zone and the privacy setting will never be
available to anyone, not even you, when you take out the SD card from the
sensor and transfer the files to your computer.</p><p>If you want to have your own data, but not publish them, consider putting the
privacy zones into the Data Portal instead. While this means you have to trust
the Data Portal software to do its job properly (and nobody will guarantee that
it does, but we promise to try our hardest), it allows you to download the
unmasked data from the portal <em>yourself</em>.</p><p>A third option is to never upload the data from your OBS directly, but instead
move the track files to your computer and use <a href=https://github.com/openbikesensor/OpenBikeSensor-Scripts/blob/main/RemovePrivacy/filterCSV.py>a
script</a>
to privatize the data before you upload it from there to the Data Portal.</p><p>The safest option of course is to never upload your data at all. But then, what
are we building a sensor for?</p><p>One more difference between configuring the privacy zones in the OpenBikeSensor
versus the Data Portal is that the sensor does not retroactively apply the
privacy settings. So if you forget a location, or did not choose the right
recording mode <em>before</em> you went for a ride, the data is already stored in the
track. The Data Portal however reapplies your privacy zones whenever you change
them, to all your past (and future) tracks. Though you have to remember that
once your data is published into the Open Data repository, anybody might have
downloaded a copy already, and you will never be able to take that back.
You should always review your settings before you publish!</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:810px><a href=/en/docs/user-guide/privacy-zones/privacy.png target=_blank><img class=card-img-top src=/en/docs/user-guide/privacy-zones/privacy_hu2b3e1d4372e401f46637adc79ad845f2_64555_800x800_fit_catmullrom_2.png width=800 height=571></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Privacy in the OBS ecosystem</p></div></div><h2 id=why-we-shift-privacy-zones>Why we shift privacy zones</h2><p>If you publish multiple tracks with anonymized data, anybody will be able to
reconstruct the <em>privacy zone</em> from the published data. The tracks going from
and to the private place inside the privacy zone will be cut off at the
boundary of the zone. If you ride your bike into different directions, away
from your private point, it is possible to mathematically redefine the circle
that you used to cut off the tracks.</p><p>Therefore, it&rsquo;s not advisable to put your privacy&rsquo;s center point right on the
location you don&rsquo;t want others to know. In the OpenBikeSensor, you have the
option to manually shift your privacy zone into a random direction. You should
only do this once for each zone. You can also use any external map tool and
manually find center coordinates for your privacy zone that seem reasonable to
you, but are not exactly your private location.</p><p>In the Data Portal you can place the circle manually on map, in a way that it
contains your private locations. Or you provide the actual private location and
let the app choose a random offset. Both ways allow you to visually review your
shifted zone before saving.</p><p>By the way, for the same reason as above, you should not <em>change</em> the offset of
your privacy zones too often. Otherwise, it&rsquo;s possible to reconstruct <em>many</em>
circles from the data, <em>all of which</em> will contain your private location. This
would defeat the purpose of shifting the privacy zone in the first place, as it
reduces the size of the area that probably contains your private location. Kind
of counter-intuitively, it reduces security instead of adding to it!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-beffaa5d188b9df46ca63cdc8d623311>1.6 - Upload tracks</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/user-guide/track-upload/>Deutsch</a>: Tracks hochladen</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-65ce47be58e50c833d4c5fe575adf07f>2 - Hardware</h1><p>This section documents the possible sensor configurations you can build for
yourself, and also provides instructions what you need to purchase and how you
are able to build your own OBS.</p><p>Starting out, make sure to check out the <a href=/en/docs/hardware/models/>model selection</a> to figure
out which version of the OBS you want to build.</p><p>Next up, you will need to figure out all the <a href=/en/docs/hardware/parts/>parts</a> that you need to
purchase or create. This includes a lot of electronic components, a PCB, the 3D
printed case and fixtures, wires and fasteners. Check out the detailed BOM for
your version.</p><p>We also provide instructions here on printing your own cases, ordering PCBs
from your favorite manufacturer, and for assembly of the sensor from all the
parts.</p><p><strong>Note:</strong> This website is still work-in-progress, and some parts of the
documentation are not complete. If you run into trouble, ask in Slack. Don&rsquo;t
expect a smooth experience just yet &ndash; but we&rsquo;re working on it. However, don&rsquo;t
fear, while not necessarily straightforward at all times, it is still very much
possible for beginners to complete this build and construct their own OBS.</p><h2 id=construction-kits>Construction kits</h2><p>Because the OpenBikeSensor consists many parts from many different sources,
bulk orders organized by local groups are advisable. Head over to Slack if you
want to organize or paricipate in a bulk order.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/construction-kit-00.03.10.jpg target=_blank><img class=card-img-top src=/en/docs/hardware/construction-kit-00.03.10_hue721a11ac8ecd4296946435a351f8f79_288603_600x0_resize_q75_catmullrom.jpg width=600 height=463></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>OpenBikeSensor Construction Kit featuring Vertical Case and PCB 00.03.10</p></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-27ad6fc5bac62f82eeb736977db5a679>2.1 - Model selection</h1><p>Starting to build an OpenBikeSensor, there are three models to choose from.</p><ul><li><code>HC-SR04P</code>, featuring the corresponding sensors and the PCB v00.02.</li><li><code>JSN-SR04T Vertical</code>, featuring the JSN-SR04T sensors, the PCB v00.03 and a case that is mounted vertically on the seat post.</li><li><code>JSN-SR04T Horizontal</code>, also featuring the JSN-SR04T sensors, the PCB v00.03, but a case that is mounted horizontally below the seat.</li></ul><p><img src=/assets/images/vertical-mount.jpg alt=Vertical>
<img src=/assets/images/horizontal-mount.jpg alt=Horizontal></p><table><thead><tr><th style=text-align:right></th><th style=text-align:center>PCB 00.02.xx</th><th style=text-align:center>PCB 00.03.xx</th></tr></thead><tbody><tr><td style=text-align:right>waterproof sensors JSN-SR04T</td><td style=text-align:center></td><td style=text-align:center>X</td></tr><tr><td style=text-align:right>inexpensive sensors HC-SR04P</td><td style=text-align:center>X</td><td style=text-align:center></td></tr><tr><td style=text-align:right>OpenBikeSensor_PCB_Case</td><td style=text-align:center>X</td><td style=text-align:center></td></tr><tr><td style=text-align:right>PCB_Case_Horizontal</td><td style=text-align:center></td><td style=text-align:center>X</td></tr><tr><td style=text-align:right>VerticalCase</td><td style=text-align:center></td><td style=text-align:center>X</td></tr></tbody></table><p><strong>Featured in the current workshops is the <em>JSN-SR04T Vertical</em>.</strong></p></div><div class=td-content style=page-break-before:always><h1 id=pg-661fbae2376b157f5023e3285970c015>2.2 - Getting a PCB</h1><div class=lead>You will need a PCB (printed circuit board) to solder all components to. Here&rsquo;s how to get one.</div><p>A central part in each sensor build is the PCB (<em>printed circuit board</em>). The
difficult part with that is the &ldquo;printed&rdquo; &ndash; a PCB is a professionally
manufactured piece of equipment that&rsquo;s hard to build yourself. Here are your options:</p><ul><li>Order the PCB using the prepared design files from a manufacturer. Depending
on <em>where</em>, at <em>which quality</em> and <em>how many boards</em> you order, this will
cost a little to a lot of money.</li><li>Find somebody who has ordered your selected PCB already and still has
duplicates in stock. Ask in Slack for this.</li><li>Build the PCB in a DIY fashion. Since the PCB uses vias and through-hole
components, this is going to be hard, but if you&rsquo;re properly equipped and
have done this before, or are not afraid of repeated failure, this might be
for you.</li><li>Don&rsquo;t use a PCB at all. You can still build a compatible sensor by soldering
together the components using wires. Beware that we don&rsquo;t provide
instructions for this though.</li></ul><h2 id=pcb-design-parameters>PCB Design Parameters</h2><p>When choosing your manufacturer, make sure that the following design choices
are supported. Each manufacturer usually provides a list of restrictions that
must not be broken. Our designs use:</p><ul><li>TODO: Via size, minimum trace width, milling path restrictions</li></ul><h2 id=gerber-files>Gerber files</h2><p>TODO: Where are they?</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0da161ca0a5800ed37ca21d9c96efab0>2.3 - Printing a case</h1><p>Similar to the PCB, you will need to get an enclosure for your sensoric device.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/case/case.jpg target=_blank><img class=card-img-top src=/en/docs/hardware/case/case_hue39e05e339c077d59aee48c72fb18c29_221514_600x0_resize_q75_catmullrom.jpg width=600 height=400></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>OpenBikeSensor Construction Kit featuring Vertical Case and PCB 00.03.10</p></div></div><ul><li>Options to get a case</li><li>Where are the source files</li><li>Printing parameters</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-65f52b9267476c5abe0ddd1c3c48c44a>2.4 - Parts Lists for all versions</h1><p>This page is used for reference when ordering parts. Please make sure to read
it carefully, and read the &ldquo;Notes&rdquo; section as well. Some items need a bit of
care when selecting from the available choices and vendors.</p><p>Note that some of these links may break in the future, we&rsquo;ll try to update them
with working links to vendors we&rsquo;ve had good experience with.</p><p>There might be errors in this list or it might become outdated, you should
refer to the design files you planning to use for building your sensor, to see
if there are any differences. Especially on orders of high value or larger
quantities, and on orders from China which take a few weeks to arrive, double
checking everything is important.</p><h3 id=notes>Notes</h3><ul><li><strong>ESP32 Development Board</strong>: There are different versions of this module, you will need one with 30 pins.</li><li><strong>SD Card</strong>: Cheap cards have caused multiple problems, choose a brand name like SanDisk.</li><li><strong>GPS Module</strong>: Consider the <a href=https://de.aliexpress.com/item/1550843440.html>large antenna variant</a> (optional in &ldquo;JSN-SR04T Vertical&rdquo; but mandatory in &ldquo;JSN-SR04T Horizontal&rdquo;), <a href=https://de.aliexpress.com/item/1005001635722164.html>alternative link with antenna only option</a></li><li><strong>Display cable</strong>: Do not go cheap on this cable, buy name brand LifY11Y, or the display connection might not work reliably. Two meters should be plenty even for large bikes and a few failed attempts at crimping its ends. Cat5 or Cat6 cable might work electrically as well, but usually isn&rsquo;t as flexible and &ldquo;nice&rdquo;.</li><li><strong>JSN-SR04T</strong>: Take care to get the right version, there are numerous variants out there, some of which do not work at all. Refer to <a href=/en/docs/hardware/parts/collective-order/>this page</a> for some more details.</li><li>Some items can be ordered for much cheaper in bulk, some are only available in bulk. Form collective orders to save a lot of money.</li><li>On some cheap items, it makes sense to order a few more than you need as spare parts (SMD resistors, screws and nuts, crimping contacts, wire). See also &ldquo;Consumables&rdquo; below.</li><li><strong>Cases</strong> need to be <a href=/en/docs/hardware/case/>3D printed in PETG</a>. There are various different designs for each use case, we&rsquo;ve just listed the most common combinations here. Have a look around the <a href=https://github.com/openbikesensor/OpenBikeSensor3dPrintableCase>case design repository</a> on Github. You can print these yourself, ask on Slack, or purchase prints of the provided files from a 3d printing service, though this is usually rather expensive.</li><li><strong>PCB</strong>: You will need a <a href=/en/docs/hardware/pcb/>special PCB manufactured</a> according to the design files. This is best done in bulk as well, somebody might have spares and can send them to you. Ask in Slack!</li></ul><h2 id=parts>Parts</h2><table class=table-bordered><thead><tr><th width=40%>Part</th><th width=20%>00.03 Vertical</th><th width=20%>00.03 Horizontal</th><th width=20%>00.02</th></tr></thead><tbody><tr><th colspan=4>Modules</th></tr><tr><td><a href=https://de.aliexpress.com/item/32928267626.html>ESP32-WROOM Development Board</a> (see note)</td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.aliexpress.com/item/32896971385.html>0.96 inch OLED Display</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.ebay.de/itm/173893903484>USB-C Charging Module</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://de.aliexpress.com/item/32865801075.html>SD card module</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.ebay.de/itm/264075497616>Buck-Boost Module for LiPo, 3.3V</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.akkuteile.de/lithium-ionen-akkus/18650/samsung/samsung-inr18650-29e-2900mah-3-7v-lithium-akku-loetfahne-u_1006211_1652>18650 LiIon Battery</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href="https://www.google.com/search?q=sandisk+ultra+16gb&tbm=shop">SD Card</a> (see note)</td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.ebay.de/itm/GPS-NEO-6M-7M-8M-GY-GPS6MV2-Module-Aircraft-Flight-Controller-For-Arduino/272373338855>GPS-NEO-6M Module</a> (see note)</td><td colspan=3 align=center>1x</td></tr><tr><th colspan=4>Basic parts</th></tr><tr><td><a href=https://www.aliexpress.com/item/4000295670163.html>12mm Push-Button</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.reichelt.de/miniatur-kippschalter-1x-ein-ein-rnd-210-00435-p240567.html>Power Switch</a></td><td colspan=3 align=center>1x</td></tr><tr><td><a href=https://www.automation24.de/pur-sensorleitung-lapp-unitronic-sensor-lify11y-5x0-25-bk-7038862>Cable for display connection</a> (see note)</td><td colspan=3 align=center>ca. 2m</td></tr><tr><td>Passive and various components</td><td colspan=3 align=center>Purchase according to <a href=https://www.reichelt.de/my/1746485>this list</a></td></tr><tr><td>16pin 2.54mm SMD connectors (<a href=https://www.ebay.de/itm/10-pcs-SMD-Buchsenleiste-1x-16-polig-RM-2-54mm-NEU-BP/231930033721>10pcs</a>, <a href=https://www.ebay.de/itm/100-pcs-SMD-Buchsenleiste-1x-16-polig-RM-2-54mm-NEW/233091176275>100pcs</a>)</td><td colspan=3 align=center>2x</td></tr><tr><td><a href=https://www.aliexpress.com/item/32512693653.html>5-pin XS9 Aviation Connector</a></td><td colspan=2 align=center>&ndash;</td><td align=center>1x</td></tr><tr><th colspan=4>Sensor modules</th></tr><tr><td><a href=https://de.aliexpress.com/item/32737648330.html>JSN-SR04T</a></td><td colspan=2 align=center>2x</td><td align=center>&ndash;</td></tr><tr><td>HC-SR04P</td><td colspan=2 align=center>&ndash;</td><td align=center>2x</td></tr><tr><th colspan=4>Custom parts</th></tr><tr><td>PCB</td><td colspan=2 align=center><a href=https://github.com/openbikesensor/OpenBikeSensor_PCB_Board/tree/merged/OpenBikeSensor03>v00.03.xx</a></td><td colspan=1 align=center><a href=https://github.com/openbikesensor/OpenBikeSensor_PCB_Board/tree/merged/OpenBikeSensor02>v00.02.xx</a></td></tr><tr><td>Case</td><td align=center><a href=https://github.com/openbikesensor/OpenBikeSensor3dPrintableCase/tree/master/MainCase/VerticalCase>Vertical Case</a></td><td align=center><a href=https://github.com/openbikesensor/OpenBikeSensor3dPrintableCase/tree/master/PCB_Case_Horizontal>Horizontal Case</a></td><td align=center>TBD</td></tr><tr><td>Display Case</td><td colspan=2 align=center><a href=https://github.com/openbikesensor/OpenBikeSensor3dPrintableCase/tree/master/DisplayCase/SlideOnDisplay>SlideOnDisplay</a></td><td align=center>TBD</td></tr><tr><td><a href=https://www.amazon.de/dp/B085CBZTQJ>Magnets 20mm x 10mm x 2mm</a></td><td colspan=2 align=center>4x</td><td align=center>TBD</td></tr><tr><td><a href=https://www.amazon.de/dp/B079KDYBZ8>Magnets 3mm x 3mm x 3mm</a></td><td align=center>4x</td><td align=center>TBD</td><td align=center>TBD</td></tr><tr><td>M3x8mm DIN912</td><td align=center>15x</td><td align=center>TBD</td><td align=center>TBD</td></tr><tr><td>M3x16mm DIN912</td><td align=center>3x</td><td align=center>TBD</td><td align=center>TBD</td></tr><tr><td>M3x45mm DIN912</td><td align=center>5x</td><td align=center>TBD</td><td align=center>TBD</td></tr><tr><td>M3x30mm DIN912</td><td align=center>5x</td><td align=center>TBD</td><td align=center>TBD</td></tr><tr><td>M3 nut DIN934</td><td align=center>27x</td><td align=center>TBD</td><td align=center>TBD</td></tr></tbody></table><h2 id=tools>Tools</h2><p>These are the tools you probably need for building the sensor. The most
specialized tool is the crimping tool, which might be available in a hacker
space / maker space / fab lab near you. It might not be needed to purchase any
of these if you can lend them.</p><ul><li><a href=https://www.amazon.de/gp/product/B07VX6YGQ8>Crimping tool</a> for JST-XH connectors (other brands or versions for these connectors, such as Engineer PA-09, are fine, too)</li><li>A decent temperature regulated soldering iron or station and a fume extraction solution (or work outside in the summer)</li><li>Tweezers, side cutters, M3 hex key</li><li>Safety eyewear, possibly gloves</li><li>ESD protection equiment (not really required, but use it if you have it)</li></ul><h2 id=consumables>Consumables</h2><p>Most of these items should also be available in any electronics workspace, so if you&rsquo;re in a maker space or similar, you can probably get the small quantities you need of these</p><ul><li>Quality solder wire</li><li>Desoldering wick</li><li>Electrical tape (preferably Kapton tape)</li><li>Shrink tube (optional)</li><li>About 25cm of 0.25 mm<sup>2</sup> / 23 AWG stranded wire</li></ul><h3 id=see-also>See also</h3><ul><li><a href=https://htmlpreview.github.io/?https://github.com/openbikesensor/OpenBikeSensor_PCB_Board/blob/Mit_Verpolschutz/BOM_for%20overview_and_ordering_Rev_00.02.07.html>Full overview of all parts for PCB 00.02.07</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d85fb319316065a6453af18f82f68315>2.4.1 - Collective Orders</h1><p>This page shall provide some information that we gathered during previous
collective orders.</p><h2 id=re-check-everything>Re-check everything</h2><p>Please note that the project is still in development, which means that changes
in hardware or design are possible anytime. Before ordering parts, especially
in large quantities, double check that the design you&rsquo;re working off of and the
list of items you are about to purchase match, and that neither is out of date
or ahead of the other.</p><h2 id=ultrasonic-sensor-boards>Ultrasonic Sensor Boards</h2><p>The most sensible parts of the OBS are the two ultrasonic sensors.
There are various models on the market, but most sold under the same name, JSN-SR04T.</p><h3 id=aj-sr04m>AJ-SR04M</h3><ul><li>Characteristics:<ul><li>Resistor R19 is used to control the behavior</li><li>8 MHz Crystal</li><li>Working Voltage: 3V to 5.5V</li></ul></li><li><a href=https://github.com/tomaskovacik/kicad-library/tree/master/library/datasheet/K02-AJ-SR04>Datasheet</a></li></ul><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/parts/collective-order/aj-sr04m-general.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/aj-sr04m-general_huae751d8764c07c64151502816b4f3c5b_719818_600x0_resize_catmullrom_2.png width=600 height=238></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>AJ-SR04M: General PCB</p></div></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/parts/collective-order/aj-sr04m-order-2021-02.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/aj-sr04m-order-2021-02_hu184eb2cf55d126d36bd2c009a05f4dfd_6737558_600x0_resize_catmullrom_2.png width=600 height=226></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>AJ-SR04M: Model from collective order in February 2021</p></div></div><h3 id=jsn-sr04t>JSN-SR04T</h3><ul><li>Characteristics:<ul><li>Probably no resistor to control the behavior</li><li>Transverse IC on the connector side</li><li>11.0592 MHz Crystal</li><li>Working Voltage: 5 V</li></ul></li><li>The datasheet found often cited on Chinese webpages is <code>JSN-SR04T一体化超声波测距说明书.pdf</code> (<a href=jsn-sr04t-en.pdf>english translation</a>).</li></ul><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:310px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-front-1.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-front-1_hua606a29ab2de5a49956e32ce009e3a37_387618_300x0_resize_catmullrom_2.png width=300 height=245></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T: Front (1)</p></div></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:310px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-front-2.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-front-2_hu48304420d4427ad8b7e31d3a69dfa05d_507688_300x0_resize_catmullrom_2.png width=300 height=204></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T: Front (2)</p></div></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:310px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-back-1.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-back-1_hu62898702615cd8e687e36d56f8908eda_212957_300x0_resize_catmullrom_2.png width=300 height=225></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T: Back (1)</p></div></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:310px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-back-2.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-back-2_hub574b5fff740f3e2a3a710deb0d7bc74_346211_300x0_resize_catmullrom_2.png width=300 height=253></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T: Back (2)</p></div></div><h3 id=jsn-sr04t-20>JSN-SR04T-2.0</h3><ul><li>Characteristics:<ul><li>Resistor R27 is used to control the behavior</li><li>8 MHz Crystal</li><li>Working Voltage: 3.3V - 5.5V</li></ul></li><li><a href="https://www.jahankitshop.com/getattach.aspx?id=4635&Type=Product">Datasheet</a></li></ul><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-2.0.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-2.0_hu3ed92257a96d64811ce717793d9a7b1f_685588_600x0_resize_catmullrom_2.png width=600 height=216></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T-2.0</p></div></div><h3 id=jsn-sr04t-v30>JSN-SR04T-V3.0</h3><ul><li>Characteristics<ul><li>Resistor &ldquo;mode&rdquo; and the shorts &ldquo;M1&rdquo; and &ldquo;M2&rdquo; are used to control the behavior</li><li>8 MHz Crystal</li><li>Working Voltage: 3.3V - 5.5V</li></ul></li><li><a href=https://de.aliexpress.com/item/32863960886.html>Documentation</a></li></ul><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><a href=/en/docs/hardware/parts/collective-order/jsn-sr04t-v3.0.png target=_blank><img class=card-img-top src=/en/docs/hardware/parts/collective-order/jsn-sr04t-v3.0_hud81a27fdf962bb6bf487928689d0271e_658700_600x0_resize_catmullrom_2.png width=600 height=230></a><div class="card-body px-0 pt-2 pb-0"><p class=card-text>JSN-SR04T-v3.0</p></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1e6374192557efdc9d48cc4785eba0e6>2.5 - Building your OBS v00.02</h1><p>TODO:</p><ul><li>why is this a good choice</li><li>link to other version</li></ul></div><div class=td-content><h1 id=pg-7fe0127b16ab48ddf24fbcf7b13373ad>2.5.1 - Build instructions v00.02</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/hardware/v00.02/build-instructions/>Deutsch</a>: Bauanleitung v00.02</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-735c2cb56859a9fd32fbf51cd2cd3581>2.6 - Building your OBS v00.03</h1><p>TODO:</p><ul><li>why is this a good choice</li><li>link to other version</li></ul></div><div class=td-content><h1 id=pg-44223aaa14ba03a465870ff5507d31cb>2.6.1 - Build instructions v00.03</h1><p>This page is not yet available in English. You might be able to read it in...</p><ul><li><a href=/docs/hardware/v00.03/build-instructions/>Deutsch</a>: Bauanleitung v00.03</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-dfd48793659645274fbc4a4e0fa01cc1>3 - Software</h1></div><div class=td-content><h1 id=pg-c5e1fe529f2ff2be7e16d98de9060468>3.1 - Firmware</h1></div><div class=td-content><h1 id=pg-6e6702eb42236c263c53cf28d2ce5b52>3.1.1 - Architecture</h1><h1 id=architecture>Architecture</h1><blockquote><p>TODO: Introduction</p></blockquote><p>Board:</p><ul><li><a href=https://github.com/espressif/arduino-esp32>ESP32 by Espressif</a></li></ul><p>Libraries:</p><ul><li><a href=https://github.com/bblanchon/ArduinoJson>ArduinoJson by Benoit Blanchon</a></li><li><a href=https://github.com/rlogiacco/CircularBuffer>CircularBuffer by AgileWare</a></li><li><a href=https://github.com/mikalhart/TinyGPSPlus>TinyGPSPlus by Mikal Hart</a></li><li><a href=https://github.com/ThingPulse/esp8266-oled-ssd1306>SSD1306 by ThingPulse</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-226236cbe2459b8085bcc02bf22e1187>3.1.2 - Setup of Development Environment</h1><p>Our firmware uses the great <a href=https://platformio.org/>PlatformIO</a> for easy
management of the toolchains and dependencies required when developing an
application for an embedded device. Thanks to this, you are rather free in the
choice of the development environment. Here are some options.</p><div class="alert alert-info" role=alert>We do not support <em>Arduino IDE</em> anymore since we&rsquo;ve switched to PlatformIO.</div><h2 id=vscode>VSCode</h2><p>The easiest way to get started is through the
<a href=https://code.visualstudio.com/>VSCode</a> IDE/Editor by Microsoft. We support it
for the foreseeable future.</p><ol><li>Download and install <a href=https://code.visualstudio.com/>Visual Studio Code</a>.</li><li>Open the <code>open-bike-sensor.code-workspace</code> in the project root.</li><li>Install the recommended extensions (this might take a while, because <a href>Platform.io</a> gets installed) and restart VSCode when required.</li><li>Linux only: Install <code>platformio-udev.rules</code> by <a href=https://docs.platformio.org/en/latest/faq.html#platformio-udev-rules>following this guide</a>.</li><li>Compile the code (Sidebar: <code>👽 > Build</code>; Bottom bar: <code>✅</code>)</li><li>Connect your ESP and upload the code (Sidebar: <code>👽 > Upload</code>; Bottom bar: ➡️)</li></ol><p>Alternatively you can also download the dependencies yourself and install it with the Arduino IDE (see below).</p><h3 id=troubleshooting>Troubleshooting</h3><ul><li><p><strong>Can&rsquo;t upload to device</strong>
You can specify the device port that VS Code should upload to. Duplicate the <code>custom_config.ini.example</code> file to <code>custom_config.ini</code> and set the <code>upload_port</code> there manually. If this option is not set, the upload port will be autodetected which can fail on some systems or might select the wrong device if other devices are plugged in.</p></li><li><p><strong>Compiling the code fails</strong>
Use the <code>Clean</code> command and delete the <code>.pio</code> directory. Compiling the code again should work now. If any errors persist, please create a new issue!</p></li></ul><h2 id=command-line>Command line</h2><ol><li>Install <code>platformio</code> command line tool for your operating system.</li><li>Clone the repository.</li><li>Copy <code>custom_config.ini.example</code> to <code>custom_config.ini</code> and modify it to
contain your upload port (only required if autodetection fails, or you want
to flash via OTA).</li><li>Connect the sensor via USB, or put it into server mode for OTA flashing.</li><li>Run <code>platformio run -t upload</code>. This will compile and upload your firmware.</li></ol><h2 id=clion>CLion</h2><p>Information on this proprietary IDE can be found
<a href=https://www.jetbrains.com/de-de/clion/>here</a>. While it works for now, it is
not officially supported by the OBS team.</p><ol><li>Install <a href=https://docs.platformio.org/en/latest/core/installation.html#installation-methods>PlatformIO Core (CLI)</a>.</li><li>Download and open <a href=https://www.jetbrains.com/de-de/clion/>CLion</a>.</li><li>Install the <a href=https://plugins.jetbrains.com/plugin/13922-platformio-for-clion>PlatformIO for CLion plugin</a>. Open <code>Configure > Plugins</code> in the welcome screen (alternatively <code>Plugins</code> in the preferences) and search for &ldquo;PlatformIO&rdquo; in the <code>Marketplace</code> tab.</li><li>Restart CLion.</li><li>Open the project folder with<code>Open or Import</code> in the welcome screen (alternatively <code>File > Open ...</code> using the menu bar)</li><li>A popup &ldquo;Create CMakeLists.txt?&rdquo; will appear. Select &ldquo;yes&rdquo;.</li><li>Open the CLion preferences and navigate to <code>Build, Execution, Deployment > CMake</code>. Delete the <code>Debug</code> profile and add a new profile. This new profile should automatically have the name <code>esp32dev</code>. Apply these changes and close the preferences.</li><li>Select the configuration <code>PlatformIO Build & Upload | esp32dev</code> in the top bar.</li><li>Use the <code>🔨 Build</code> button to compile the code.</li><li>Connect your ESP and use the <code>▶ Run</code> button to compile and upload the code. To upload without re-compiling the code, switch to the configuration <code>PlatformIO Only Upload | esp32dev</code> in the top bar.</li></ol><h3 id=troubleshooting-1>Troubleshooting</h3><ul><li><p><strong>Can&rsquo;t upload to device</strong>
You can specify the device port that CLion should upload to. Duplicate the <code>custom_config.ini.example</code> file to <code>custom_config.ini</code> and set the <code>upload_port</code> there manually. If this option is not set, the upload port will be autodetected which can fail on some systems or might select the wrong device if other devices are plugged in.</p></li><li><p><strong>Compiling the code fails</strong>
In the menu bar run/click <code>Tools > PlatformIO > Re-Init</code> and then try to compile the code again. If this didn&rsquo;t fix it delete the directories <code>.pio</code> and <code>cmake-build-*</code>. Compiling the code again should work now. If any errors persist, please create a new issue!</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-51331aee17c036ec192377ca955df78c>3.1.3 - Coding Guidelines</h1><h2 id=platformioini>platformio.ini</h2><p>The <code>platformio.ini</code> is the main project configuration file.
It configures <a href=https://docs.platformio.org/en/latest/projectconf/section_platformio.html#id4>PlatformIO</a> to build and flash the ESP32</p><h2 id=custom_configini>custom_config.ini</h2><p>PlatformIO supports the option <a href=https://docs.platformio.org/en/latest/projectconf/section_platformio.html>extra_configs</a>,
which allows to include additional configurations. Our <code>platformio.ini</code> is preconfigured a custion configuraion inthe file <code>custom_config.ini</code>.
An example custion configuration file can be found in the root folder of the firmware.</p><h3 id=developer-mode>Developer mode</h3><p>To enable the developer mode, uncomment the following line in the <code>custom_config.ini</code> and flash the firmware:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>build_flags</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>-D DEVELOP</span>
</code></pre></div><p>The developer mode enables additional dvelopment options menu in the configuration web interface, where it&rsquo;s possible to configure:</p><ul><li>whether the grid on the display is shown (useful for text debugging)</li><li>whether the WLAN password should be printed to the serial interface (useful for WLAN debugging)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2df86ca66efc82c707a6685b81577602>3.1.4 - Upgrading the Firmware from 0.2.x to 0.3.x</h1><p>Da sich das interne Partitionsschema des OpenBikeSensors geändert hat, ist es für eine Version kleiner 0.3 notwendig, das Upgrade über den USB-Port durchzuführen.</p><p>Dazu muss man das Gerät aufschrauben und den internen USB-Port mit dem PC per Kabel verbinden.</p><h2 id=vorbereitungen>Vorbereitungen</h2><p>Über die Weboberfläche sollte man die Konfiguration des OpenBikeSensors herunterladen, da diese beim Upgrade zurückgesetzt wird. Das Zurücksetzen passiert nur bei einem Upgrade von &lt;0.3 auf 0.3, bei anderen Upgrades bleibt die Konfiguration erhalten.</p><p>Nach dem Upgrade startet man den OpenBikeSensor entweder ohne angeschlossenes Display oder hält den Bestätigungsknopf beim Einschalten fest, sodass das Gerät einen WLAN-Hotspot startet. Darüber lässt sich dann das Backup der Konfiguration wieder auf das Gerät hochladen.</p><h2 id=upgrade>Upgrade</h2><h3 id=linux>Linux</h3><p><strong>/dev/ttyUSB0</strong> muss für den Benutzer beschreibbar sein.</p><h4 id=variante-1-download-und-esptool>Variante 1: Download und Esptool</h4><p>Die aktuelle Firmware kann man <a href=https://github.com/openbikesensor/OpenBikeSensorFirmware/releases>hier herunterladen</a>.</p><p>Dann führt man aus:</p><p><code>esptool.py --port /dev/ttyUSB0 write_flash FIXME(Adresse) pfad/zur/firmware.bin</code></p><p>Ausgabe:</p><pre><code>esptool.py v2.8
Serial port /dev/ttyUSB0
Connecting....
Detecting chip type... ESP32
Chip is ESP32D0WDQ6 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
Crystal is 40MHz
MAC: 24:6f:28:a0:c9:18
Uploading stub...
Running stub...
Stub running...
Configuring flash size...
Auto-detected Flash size: 4MB
Compressed 1818864 bytes to 1057296...
Wrote 1818864 bytes (1057296 compressed) at 0x00001000 in 93.4 seconds (effective 155.8 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...
</code></pre><h4 id=variante-2-git-und-platformio>Variante 2: Git und PlatformIO</h4><p>Git und PlatformIO müssen installiert sein.</p><p>Zuerst klont man das Repo mit der Firmware.</p><p><code>git clone https://github.com/openbikesensor/OpenBikeSensorFirmware.git</code></p><p>Dann wechselt man in das Verzeichnis
<code>cd OpenBikeSensorFirmware</code></p><p>und führt das folgende Kommando aus:</p><p><code>platformio run --target upload -e esp32dev</code></p><p>Die Ausgabe sollte so aussehen:</p><pre><code>Processing esp32dev (platform: espressif32; board: esp32dev; framework: arduino)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Tool Manager: Installing platformio/tool-mkspiffs @ ~2.230.0
Tool Manager: tool-mkspiffs @ 2.230.0 has been installed!
Verbose mode can be enabled via `-v, --verbose` option
CONFIGURATION: https://docs.platformio.org/page/boards/espressif32/esp32dev.html
PLATFORM: Espressif 32 (2.0.0) &gt; Espressif ESP32 Dev Module
HARDWARE: ESP32 240MHz, 320KB RAM, 4MB Flash
DEBUG: Current (esp-prog) External (esp-prog, iot-bus-jtag, jlink, minimodule, olimex-arm-usb-ocd, olimex-arm-usb-ocd-h, olimex-arm-usb-tiny-h, olimex-jtag-tiny, tumpa)
[...]
</code></pre><h3 id=windows>Windows</h3><p>FIXME</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86bf20d39037f4ae49a1ae0ca3c28fa3>4 - Acknowledgments</h1><blockquote><p>We stand on the shoulders of giants.</p></blockquote><p>The development of the OpenBikeSensor would not have been possible without the
work of countless other people who, like us, chose to publish their work and
make it available for everyone.</p><p>While we cannot list everything we build upon, here are some honorable mentions
that we would like to acknowledge, either because they are obscure and little
known but deserve publicity, or have tremendous impact on our project.</p><p>In no particular order:</p><ul><li>The <a href=https://arduinojson.org/v6/example/config/>ArduinoJson</a> library</li><li><a href=https://lastminuteengineers.com/esp32-ota-web-updater-arduino-ide/>Interface for OTA Web Updates</a> by lastminuteengineers.com</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 OpenBikeSensor contributors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js integrity=sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script></body></html>